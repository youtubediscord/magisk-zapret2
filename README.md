# Zapret2 для Android (Magisk модуль)

Модуль для обхода блокировок сайтов на Android с root-доступом.

## Что это такое?

### Простыми словами

Когда вы открываете YouTube, Discord или другой заблокированный сайт, ваш провайдер видит куда вы идёте и блокирует соединение. Этот модуль "маскирует" ваш трафик так, что провайдер не может его распознать и заблокировать.

### Техническое объяснение

**DPI (Deep Packet Inspection)** — технология глубокого анализа пакетов, которую провайдеры используют для блокировки сайтов. DPI анализирует содержимое пакетов и определяет, к какому сайту вы подключаетесь.

**Zapret2** — инструмент для обхода DPI. Он модифицирует сетевые пакеты таким образом, что DPI не может их правильно проанализировать, но сервер (YouTube, Discord и т.д.) получает их корректно.

**Как это работает:**
```
Ваше приложение → [Zapret2 модифицирует пакеты] → Провайдер (DPI не видит) → Сайт работает!
```

---

## Требования

- Android 7.0+ (API 24+)
- **Root-доступ** через Magisk 20.4+
- Ядро с поддержкой NFQUEUE (есть в большинстве ядер)

---

## Установка

### Шаг 1: Скачайте модуль

Скачайте `zapret2-magisk-v*.zip` из [Releases](https://github.com/youtubediscord/magisk-zapret2/releases)

### Шаг 2: Установите через Magisk

1. Откройте **Magisk Manager**
2. Перейдите в **Modules** (внизу)
3. Нажмите **Install from storage**
4. Выберите скачанный ZIP файл
5. Дождитесь установки
6. **Перезагрузите устройство**

### Шаг 3: Проверьте работу

После перезагрузки модуль запустится автоматически. Попробуйте открыть YouTube или Discord.

---

## Настройка стратегий

Разные провайдеры используют разные методы блокировки, поэтому может потребоваться выбор подходящей стратегии.

### Через Magisk Manager

1. Откройте **Magisk Manager** → **Modules**
2. Найдите **Zapret2 DPI Bypass**
3. Нажмите кнопку **Action** (⚡ молния)
4. Откроется консольное меню

### Меню настройки

```
╔══════════════════════════════════════╗
║     Zapret2 - Настройка стратегий    ║
╠══════════════════════════════════════╣
║  1) YouTube         [strategy_name]  ║
║  2) Discord         [strategy_name]  ║
║  3) Telegram        [strategy_name]  ║
║  4) Другие сайты    [strategy_name]  ║
║  5) UDP/QUIC        [strategy_name]  ║
║──────────────────────────────────────║
║  6) Запустить Zapret                 ║
║  7) Остановить Zapret                ║
║  8) Перезапустить                    ║
║  9) Статус                           ║
║  0) Выход                            ║
╚══════════════════════════════════════╝
```

Выберите категорию (1-5) и затем стратегию из списка.

---

## Какую стратегию выбрать?

### Начните с этих (работают у большинства):

| Категория | Рекомендуемая стратегия |
|-----------|------------------------|
| YouTube | `syndata_7_tls_google_multisplit_midsld` |
| Discord | `syndata_7_tls_google_multisplit_midsld` |
| Telegram | `syndata_7_tls_google_multisplit_midsld` |
| UDP/QUIC | `fake_x6_quic` |

### Если не работает:

Попробуйте по очереди:
1. `censorliber_google_syndata` — более агрессивная
2. `censorliber_google_syndata_v2` — с модификацией TLS
3. `alt11_100_syndata` — альтернативный метод

### Для Discord голосовых каналов:

Выберите `fake_x6_stun_discord` в категории Discord — это включит обход для голосового трафика.

---

## Команды терминала

Если у вас есть терминал (Termux), можно управлять напрямую:

```bash
# Запустить
su -c zapret2-start

# Остановить
su -c zapret2-stop

# Статус
su -c zapret2-status

# Посмотреть логи
su -c "logcat -s Zapret2"
```

---

## Решение проблем

### YouTube/Discord всё ещё не работает

1. **Попробуйте другую стратегию** — у разных провайдеров разные DPI
2. **Перезапустите модуль** — Action → "Перезапустить"
3. **Проверьте логи** — `logcat -s Zapret2`

### Модуль не запускается

Проверьте поддержку NFQUEUE:
```bash
su -c "cat /proc/net/netfilter/nf_queue"
```
Если файл не существует — ваше ядро не поддерживает NFQUEUE.

### Конфликт с AdGuard/AFWall+

Эти приложения тоже используют iptables. Попробуйте:
1. Отключить их временно для теста
2. Или изменить QNUM в конфиге на другое число (201, 202)

### Интернет стал медленнее

Это нормально — обработка пакетов требует ресурсов. Если сильно медленно:
1. Уменьшите `PKT_OUT` в конфиге (например, с 20 до 10)
2. Отключите категории которые не используете

---

## Часто задаваемые вопросы

### Это легально?

Использование инструментов для обхода блокировок для личных целей не запрещено. Однако законы различаются в разных странах.

### Это VPN?

Нет. VPN шифрует весь трафик и отправляет через другой сервер. Zapret2 только модифицирует пакеты чтобы обмануть DPI, трафик идёт напрямую.

### Провайдер увидит что я использую обход?

DPI не сможет определить содержимое трафика, но провайдер увидит что вы подключаетесь к IP-адресам YouTube/Discord. Для полной анонимности нужен VPN.

### Работает ли с мобильным интернетом?

Да, работает с любым подключением — Wi-Fi, 4G, 5G.

### Батарея садится быстрее?

Незначительно. Модуль обрабатывает только первые пакеты соединения.

### Как обновить модуль?

Скачайте новую версию и установите поверх старой через Magisk Manager.

---

## Конфигурация (для продвинутых)

Файл конфигурации: `/data/adb/modules/zapret2/zapret2/config.sh`

```bash
# Автозапуск при загрузке
AUTOSTART=1

# Номер очереди NFQUEUE (менять при конфликтах)
QNUM=200

# Порты для перехвата
PORTS_TCP="80,443"
PORTS_UDP="443"

# Сколько первых пакетов обрабатывать
PKT_OUT=20
PKT_IN=10

# Режим логирования: android | syslog | file | none
LOG_MODE="android"
```

---

## Благодарности

- [bol-van/zapret](https://github.com/bol-van/zapret) — оригинальный проект
- Сообщество за тестирование и стратегии

---

## Лицензия

MIT License — свободное использование и модификация.
